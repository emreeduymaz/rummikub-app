<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styling.css') }}">
    <title>Okey Game</title>
    <style>
        .tile {
            cursor: pointer;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body>
<div class="yesil">
    <div class="mavi">
        <div class="box top-center"></div>
        <div class="box bottom-center">
            <ul class="tiles" id="sortable-tiles">
                {% for tile in starting_tiles %}
                <li class="tile" style="color:{{tile.color}}; text-align: center;" draggable="true">{{tile.number}}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="box right-center"></div>
        <div class="box left-center"></div>
        <div class="box drop-southeast" ondrop="drop(event, 'southeast')" ondragover="allowDrop(event)"></div>
        <div class="box drop-northeast" ondrop="drop(event, 'northeast')" ondragover="allowDrop(event)"></div>
        <div class="box drop-northwest" ondrop="drop(event, 'northwest')" ondragover="allowDrop(event)"></div>
        <div class="box drop-southwest" ondrop="drop(event, 'southwest')" ondragover="allowDrop(event)"></div>
        <div class="box ground-tiles">
            <li class="tile" style="text-align: center;" draggable="false">
                {{ground_tiles|length}}
            </li>
        </div>
        <div class="box okey-tile">
            <li class="tile" style="color:{{okey_tile.color}}; text-align: center;" draggable="false">{{okey_tile.number}}</li>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tiles = document.querySelectorAll('.tile');
        const dropZones = document.querySelectorAll('.box.drop-southeast, .box.drop-northeast, .box.drop-northwest, .box.drop-southwest');

        tiles.forEach(tile => {
            tile.addEventListener('dragstart', dragStart);
        });

        dropZones.forEach(dropZone => {
            dropZone.addEventListener('dragover', allowDrop);
            dropZone.addEventListener('drop', dragDrop);
        });

        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.innerHTML);
            e.dataTransfer.setData('text/color', e.target.style.color);
            e.dataTransfer.setData('text/index', Array.from(e.target.parentNode.children).indexOf(e.target));
            e.target.classList.add('dragging');
        }

        function allowDrop(e) {
            e.preventDefault();
        }

        function dragDrop(e) {
            e.preventDefault();
            const draggedTile = document.querySelector('.dragging');
            const newOwner = e.target.classList.contains('box') ? e.target : e.target.parentNode;

            const tileNumber = e.dataTransfer.getData('text/plain');
            const tileColor = e.dataTransfer.getData('text/color');
            const tileIndex = e.dataTransfer.getData('text/index');

            newOwner.appendChild(draggedTile);
            draggedTile.classList.remove('dragging');
            draggedTile.innerHTML = tileNumber;
            draggedTile.style.color = tileColor;

            updateTilesList(newOwner);
        }

        function updateTilesList(container) {
            const tiles = Array.from(container.children);
            tiles.forEach((tile, index) => {
                if (index === tiles.length - 1) {
                    tile.style.display = 'block';
                } else {
                    tile.style.display = 'none';
                }
            });
        }

        new Sortable(document.getElementById('sortable-tiles'), {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function () {
                const tiles = Array.from(document.getElementById('sortable-tiles').children);
                tiles.forEach(tile => {
                    tile.style.display = 'block';
                });
            }
        });
    });
</script>
</body>
</html>
